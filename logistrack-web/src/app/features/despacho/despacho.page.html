<!-- src/app/features/despacho/despacho.page.html -->
<section class="py-4 px-4" *ngIf="vm$ | async as vm">
  <div class="mx-auto max-w-6xl space-y-4">
    <h2 class="text-2xl font-semibold">Despacho</h2>

    <div class="bg-gray-50 rounded-2xl shadow-sm p-4">
      <!-- ✅ solo cd y pyme_id -->
      <app-filters-bar
        [fields]="fields"
        [value]="{ cd: vm.q.cd, pyme: vm.q.pyme }"
        [autoApply]="true"
        (change)="onFilters($event)"
        (cleared)="onCleared()">
      </app-filters-bar>
    </div>

    <app-error-state
      *ngIf="vm.error"
      [message]="'No se pudo cargar las órdenes.'"
      (retry)="onFilters(vm.q)">
    </app-error-state>

    <app-empty-state
      *ngIf="!vm.error && !vm.loading && vm.count === 0"
      title="Sin órdenes"
      subtitle="Ajusta los filtros e inténtalo nuevamente.">
    </app-empty-state>

    <div *ngIf="!vm.error && vm.count > 0" class="bg-gray-50 rounded-2xl shadow-sm p-2">
      <app-table
        [columns]="columns"
        [value]="vm.data"
        [totalRecords]="vm.count"
        [rows]="ROWS"
        [first]="firstOf(vm.q.page)"
        [loading]="vm.loading"
        (page)="onPage($event, vm.q)">
      </app-table>
    </div>
  </div>
</section>
